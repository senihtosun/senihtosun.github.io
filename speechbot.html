<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Voice Bot</title>

	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/p5@1.0.0/lib/p5.min.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/p5@1.0.0/lib/addons/p5.sound.min.js"></script>
    	<script type="text/javascript" src="static/p5.speech.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

</head>
<body>

    <div class='text-center'>
        <h1 id='text-appear'> Talk with me boi  </h1>
    </div>

</body>

	<script>
		let currentTime = new Date().toLocaleTimeString()
		let currentDate = new Date().toLocaleDateString()

		let speechRec = new p5.SpeechRec(); // speech recognition object
    		let speechSynth = new p5.Speech() // speech synthesis object
    
    		speechRec.onResult = respond; // bind callback function to trigger when speech is recognized

    		continuous = true
    		interim = false

    		// Start listening	
    		speechRec.start(continuous, interim); // start listening

		// Function for getting user's geological location and weather information
		function getWeather(){
			
			$.ajax({
				url: "https://geolocation-db.com/jsonp",
			  	jsonpCallback: "callback",
			  	dataType: "jsonp",
			  	success: function(location) {
			    		let cityName = location.city
			  	}
			});
				
			console.log(cityName)
			
			fetch('https://api.openweathermap.org/data/2.5/weather?q=greensboro&units=metric&appid=50a7aa80fa492fa92e874d23ad061374')
			.then(response => response.json())
			.then(data => {  
				var temperature = data['main']['temp'];
				var description = data['weather'][0]['description'];
				speechSynth.speak('the temperature is ' + temperature + 'celcius,  with ' + description)
			})
		}	
			  
		
		
    		// Function to respond to commands
    		function respond(){
      			switch(speechRec.resultString){
        			case 'hello': speechSynth.speak('Hi this is Piri how can I help you'); break;
        			case 'what time is it': speechSynth.speak('The time is' + currentTime.split(':')[0] + ' ' + currentTime.split(':')[1]); break;
        			case 'good morning': speechSynth.speak('morning how can I help you'); break;
        			case 'good night': speechSynth.speak('Have a good night'); break; 
        			case 'where is the author from': speechSynth.speak('He is from Turkey'); break;
        			case 'what is the date today': speechSynth.speak('Today is' + currentDate); break;
				case 'what is the weather like': getWeather(); break; 
      			}
    		}
	
	</script>
	
</html>
